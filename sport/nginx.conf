server {
    listen 8010;
    server_name localhost;

    client_max_body_size 110M;
    client_body_buffer_size 16M;

    root /usr/share/nginx/html;
    index index.html;

    # เสิร์ฟไฟล์อัปโหลดโดยตรง
    location /uploads/ {
        alias /data/uploads/;     # ต้องมี / ปิดท้าย
        try_files $uri =404;

        # ตัวช่วย header เล็กน้อย (ไม่ต้องใช้ types block)
        add_header X-Content-Type-Options nosniff always;
        add_header Access-Control-Allow-Origin *;
        expires 1h;
        access_log off;
    }

    # SPA
    location / {
        try_files $uri $uri/ /index.html;
    }

    # proxy ไป backend
    location /api/ {
        proxy_pass http://backend:8020;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_connect_timeout 300;
        proxy_send_timeout    300;
        proxy_read_timeout    300;
        send_timeout          300;

        proxy_request_buffering off;
        proxy_buffering       off;
    }

    location /auth/ {
        proxy_pass http://backend:8020;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_connect_timeout 300;
        proxy_send_timeout    300;
        proxy_read_timeout    300;
        send_timeout          300;

        proxy_request_buffering off;
        proxy_buffering       off;
    }
}









# server {
#     listen 8010;
#     server_name localhost;

#     # ✅ อนุญาตอัพโหลดได้ถึง 100MB (ตั้งตรงนี้พอ ครอบคลุมทุก location)
#     client_max_body_size 110M;          # กัน margin เผื่อ header/encoding
#     client_body_buffer_size 16M;        # กันเคส body ใหญ่กว่าบัฟเฟอร์เดิม

#     root /usr/share/nginx/html;
#     index index.html;

#     # SPA / Vue
#     location / {
#         try_files $uri $uri/ /index.html;
#     }

#     # === Proxy ไป backend ===
#     # แนะนำเปิด header และ timeout เผื่ออัพโหลดไฟล์ใหญ่ ใช้เวลานาน
#     location /api/ {
#         proxy_pass http://backend:8020;

#         # headers มาตรฐาน
#         proxy_set_header Host              $host;
#         proxy_set_header X-Real-IP         $remote_addr;
#         proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;

#         # เผื่ออัพโหลด/ประมวลผลนาน
#         proxy_connect_timeout  300s;
#         proxy_send_timeout     300s;
#         proxy_read_timeout     300s;
#         send_timeout           300s;

#         # ถ้า backend (Node/Express) ต้องการสตรีมอัพโหลดตรง ๆ ให้ปิดการ buffer ของ Nginx
#         # (ถ้าไม่ต้องสตรีม/ไม่ได้มีปัญหา อาจคอมเมนต์บรรทัดนี้ไว้ได้)
#         proxy_request_buffering off;
#         proxy_buffering         off;
#     }

#     location /auth/ {
#         proxy_pass http://backend:8020;

#         proxy_set_header Host              $host;
#         proxy_set_header X-Real-IP         $remote_addr;
#         proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;

#         proxy_connect_timeout  300s;
#         proxy_send_timeout     300s;
#         proxy_read_timeout     300s;
#         send_timeout           300s;

#         proxy_request_buffering off;
#         proxy_buffering         off;
#     }

#     # ===== Proxy PDF จาก reserv-scc.mfu.ac.th โดยบังคับ Content-Type =====
# # ใช้เส้นทางแบบ /file-proxy/uploads/<ชื่อไฟล์>.pdf
# location ~* ^/file-proxy/uploads/.+\.pdf$ {
#     # proxy ไปต้นทาง (HTTPS)
#     proxy_pass https://reserv-scc.mfu.ac.th;

#     # ให้ Host header ตรงกับปลายทาง
#     proxy_set_header Host reserv-scc.mfu.ac.th;
#     proxy_ssl_server_name on;

#     # ปิดการ buffer (ช่วยเวลาสตรีมไฟล์ใหญ่)
#     proxy_buffering off;

#     # ===== บังคับ header ที่จำเป็นกับ Chrome PDF Viewer =====
#     add_header Content-Type application/pdf always;
#     add_header X-Content-Type-Options nosniff always;
#     add_header Accept-Ranges bytes always;

#     # ไว้ใจเฉพาะไฟล์ pdf ภายใต้ /uploads/ เท่านั้น (ตาม regex)
# }

# location /uploads/ {
#         proxy_pass http://backend:8021;
#         proxy_set_header Host              $host;
#         proxy_set_header X-Real-IP         $remote_addr;
#         proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_request_buffering off;
#         proxy_buffering         off;
#     }



# }



#  server {
#     listen 8010;
#     server_name reserv-scc.mfu.ac.th localhost;


#     root /usr/share/nginx/html;
#     index index.html;

#     location / {
#         try_files $uri $uri/ /index.html;
#     }

#     # ตัวอย่าง Proxy API ถ้าอยากส่ง request ไป backend
#      location /api/ {
#          proxy_pass http://backend:8020;
#      }

#      location /auth/ {
#          proxy_pass http://backend:8020;
#      }
# }


# server {
#     listen 8010;
#     server_name reserv-scc.mfu.ac.th;

#     root /usr/share/nginx/html;
#     index index.html;

#     location / {
#         try_files $uri $uri/ /index.html;
#     }

#     location /api/ {
#         proxy_pass http://backend:8020;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }

#     location /auth/ {
#         proxy_pass http://backend:8020;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;

#     }
# }


